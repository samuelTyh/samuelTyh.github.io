<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Building a Production-Ready Data Pipeline with Airflow and dbt" />
<meta property="og:locale" content="en" />
<meta name="description" content="A comprehensive walkthrough of implementing a modern sales data engineering pipeline with Airflow, dbt, and PostgreSQL, focusing on practical insights and real-world patterns." />
<meta property="og:description" content="A comprehensive walkthrough of implementing a modern sales data engineering pipeline with Airflow, dbt, and PostgreSQL, focusing on practical insights and real-world patterns." />
<link rel="canonical" href="http://localhost:4000/posts/building-a-production-ready-data-pipeline-with-airflow-and-dbt/" />
<meta property="og:url" content="http://localhost:4000/posts/building-a-production-ready-data-pipeline-with-airflow-and-dbt/" />
<meta property="og:site_name" content="samueltyh" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-04-28T14:30:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Building a Production-Ready Data Pipeline with Airflow and dbt" />
<meta name="twitter:site" content="@samueltyh" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-04-28T14:30:00+02:00","datePublished":"2025-04-28T14:30:00+02:00","description":"A comprehensive walkthrough of implementing a modern sales data engineering pipeline with Airflow, dbt, and PostgreSQL, focusing on practical insights and real-world patterns.","headline":"Building a Production-Ready Data Pipeline with Airflow and dbt","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/building-a-production-ready-data-pipeline-with-airflow-and-dbt/"},"url":"http://localhost:4000/posts/building-a-production-ready-data-pipeline-with-airflow-and-dbt/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Building a Production-Ready Data Pipeline with Airflow and dbt | samueltyh
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">



  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/AvatarMaker.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">samueltyh</a>
    <p class="site-subtitle fst-italic mb-0">Data Engineering, Learning by making, Career reflections</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tag"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    

      
        <a
          href="https://github.com/samueltyh"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    

      
        <a
          href="https://twitter.com/samueltyh"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    

      
        <a
          href="javascript:location.href = 'mailto:' + ['samuel.tseng.de','gmail.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
          
        

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>Building a Production-Ready Data Pipeline with Airflow and dbt</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>Building a Production-Ready Data Pipeline with Airflow and dbt</h1>
    
      <p class="post-desc fw-light mb-4">A comprehensive walkthrough of implementing a modern sales data engineering pipeline with Airflow, dbt, and PostgreSQL, focusing on practical insights and real-world patterns.</p>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1745843400"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Apr 28, 2025
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://twitter.com/samueltyh">Samuel Tseng</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="3129 words"
>
  <em>17 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">Building a Production-Ready Data Pipeline with Airflow and dbt</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">Building a Production-Ready Data Pipeline with Airflow and dbt</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <p>In today’s data-driven business landscape, transforming raw operational data into actionable insights requires robust, scalable data pipelines. I recently designed and implemented a comprehensive data engineering solution for sales analytics that bridges raw transactional data to dimensional models. This post walks through the architecture, implementation decisions, and practical patterns that you can apply to your own data engineering projects.</p>

<h2 id="the-challenge-from-sales-transactions-to-analytics"><span class="me-2">The Challenge: From Sales Transactions to Analytics</span><a href="#the-challenge-from-sales-transactions-to-analytics" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>The core challenge was to build a pipeline that would:</p>

<ol>
  <li>Ingest sales transaction data from multiple CSV sources</li>
  <li>Handle common data quality issues (missing values, inconsistent formats)</li>
  <li>Transform raw data into a dimensional model for analytics</li>
  <li>Implement incremental processing for efficiency</li>
  <li>Ensure reliability with comprehensive testing and error handling</li>
</ol>

<h2 id="architecture-design-medallion-pattern-implementation"><span class="me-2">Architecture Design: Medallion Pattern Implementation</span><a href="#architecture-design-medallion-pattern-implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>After evaluating several architectural approaches, I implemented a medallion architecture (also called multi-hop architecture), which organizes data through progressive refinement stages:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Raw CSV Data → Bronze Layer (raw.sales) → Silver Layer (transformed.dim_*) → Gold Layer (analytics.fact_sales)
</pre></td></tr></tbody></table></code></div></div>

<p>This layered approach provides several key advantages:</p>
<ul>
  <li>Clear separation of concerns</li>
  <li>Progressive data quality improvement</li>
  <li>Complete data lineage traceability</li>
  <li>Flexibility to rebuild downstream layers without re-ingesting source data</li>
</ul>

<h3 id="database-schema-design"><span class="me-2">Database Schema Design</span><a href="#database-schema-design" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>I designed the following schema structure:</p>

<ul>
  <li><strong>Bronze Layer</strong>: Raw data storage with original values preserved
    <ul>
      <li><code class="language-plaintext highlighter-rouge">raw.sales</code>: Original CSV data with added metadata columns</li>
    </ul>
  </li>
  <li><strong>Silver Layer</strong>: Cleaned and transformed dimensional models
    <ul>
      <li><code class="language-plaintext highlighter-rouge">transformed.dim_product</code>: Product information</li>
      <li><code class="language-plaintext highlighter-rouge">transformed.dim_retailer</code>: Retailer information</li>
      <li><code class="language-plaintext highlighter-rouge">transformed.dim_location</code>: Location information</li>
      <li><code class="language-plaintext highlighter-rouge">transformed.dim_channel</code>: Sales channel information</li>
      <li><code class="language-plaintext highlighter-rouge">transformed.dim_date</code>: Date dimension with hierarchies</li>
      <li><code class="language-plaintext highlighter-rouge">transformed.fact_sales</code>: Sales fact table with foreign keys and measures</li>
    </ul>
  </li>
  <li><strong>Gold Layer</strong>: Analytics-ready views and aggregates
    <ul>
      <li><code class="language-plaintext highlighter-rouge">analytics.dim_*</code>: Analytics-ready dimension views</li>
      <li><code class="language-plaintext highlighter-rouge">analytics.fact_sales</code>: Optimized analytical fact table</li>
    </ul>
  </li>
</ul>

<h2 id="implementation-core-components"><span class="me-2">Implementation: Core Components</span><a href="#implementation-core-components" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="1-data-ingestion-module"><span class="me-2">1. Data Ingestion Module</span><a href="#1-data-ingestion-module" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The ingestion component follows a “validate-first, then clean” pattern, which provides better visibility into data quality issues:</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Main function to process and load data.
    New flow: Validate first, then clean only records that need cleaning.
    </span><span class="sh">"""</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Starting data ingestion process for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Read the CSV file
</span>        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Reading file: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Successfully read </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s"> records from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># First validate the data as-is
</span>        <span class="n">is_valid</span><span class="p">,</span> <span class="n">invalid_indices</span> <span class="o">=</span> <span class="nf">validate_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Data validation failed. Applying cleaning steps...</span><span class="sh">"</span><span class="p">)</span>
            <span class="c1"># Apply cleaning only after validation fails
</span>            <span class="n">df</span> <span class="o">=</span> <span class="n">CleanData</span><span class="p">.</span><span class="nf">apply_all_cleaners</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            
            <span class="c1"># Re-validate after cleaning
</span>            <span class="n">is_valid</span><span class="p">,</span> <span class="n">invalid_indices</span> <span class="o">=</span> <span class="nf">validate_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid</span><span class="p">:</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sh">"</span><span class="s">Data still contains invalid records after cleaning. Filtering them out.</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="nf">filter_invalid_records</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">invalid_indices</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Data cleaning resolved all validation issues.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Data passed validation without cleaning.</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Check for duplicates
</span>        <span class="n">deduplicated_df</span> <span class="o">=</span> <span class="nf">detect_duplicates</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        
        <span class="c1"># Only proceed with loading if we have records
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">deduplicated_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Get database connection string
</span>            <span class="n">connection_string</span> <span class="o">=</span> <span class="nf">get_db_connection_string</span><span class="p">()</span>
            
            <span class="c1"># Load to raw schema
</span>            <span class="n">records_loaded</span> <span class="o">=</span> <span class="nf">load_to_raw</span><span class="p">(</span><span class="n">deduplicated_df</span><span class="p">,</span> <span class="n">connection_string</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
            
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Data ingestion complete. </span><span class="si">{</span><span class="n">records_loaded</span><span class="si">}</span><span class="s"> records processed.</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">records_loaded</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sh">"</span><span class="s">No valid records to load after validation and deduplication.</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error in data ingestion process: </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">raise</span>
</pre></td></tr></tbody></table></code></div></div>

<p>I encapsulated the cleaning operations in a dedicated class with specialized methods for each type of cleaning:</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">CleanData</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    A class for handling different types of data cleaning operations.
    Each method handles a specific type of cleaning.
    </span><span class="sh">"""</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">handle_missing_values</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Handle missing values in the DataFrame.</span><span class="sh">"""</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Cleaning: Handling missing values...</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">df_cleaned</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
        <span class="n">df_cleaned</span><span class="p">[</span><span class="sh">'</span><span class="s">Location</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_cleaned</span><span class="p">[</span><span class="sh">'</span><span class="s">Location</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">'</span><span class="s">Unknown</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df_cleaned</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">clean_price_values</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Clean price values by removing currency symbols.</span><span class="sh">"""</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Cleaning: Cleaning price values...</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">df_cleaned</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
        
        <span class="c1"># Handle price with currency notation
</span>        <span class="n">df_cleaned</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_cleaned</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="sh">'</span><span class="s">USD</span><span class="sh">'</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">df_cleaned</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_cleaned</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="sh">'</span><span class="s">USD</span><span class="sh">'</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">USD</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span>
        
        <span class="c1"># Strip whitespace
</span>        <span class="n">df_cleaned</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_cleaned</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">df_cleaned</span>
    
    <span class="c1"># More cleaning methods...
</span>    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">apply_all_cleaners</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Apply all cleaning methods in sequence.</span><span class="sh">"""</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Starting comprehensive data cleaning...</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="n">df_result</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
        <span class="n">df_result</span> <span class="o">=</span> <span class="n">cls</span><span class="p">.</span><span class="nf">handle_missing_values</span><span class="p">(</span><span class="n">df_result</span><span class="p">)</span>
        <span class="n">df_result</span> <span class="o">=</span> <span class="n">cls</span><span class="p">.</span><span class="nf">standardize_data_types</span><span class="p">(</span><span class="n">df_result</span><span class="p">)</span>
        <span class="n">df_result</span> <span class="o">=</span> <span class="n">cls</span><span class="p">.</span><span class="nf">remove_whitespace_values</span><span class="p">(</span><span class="n">df_result</span><span class="p">)</span>
        <span class="n">df_result</span> <span class="o">=</span> <span class="n">cls</span><span class="p">.</span><span class="nf">clean_price_values</span><span class="p">(</span><span class="n">df_result</span><span class="p">)</span>
        <span class="n">df_result</span> <span class="o">=</span> <span class="n">cls</span><span class="p">.</span><span class="nf">clean_date_values</span><span class="p">(</span><span class="n">df_result</span><span class="p">)</span>
        
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Comprehensive data cleaning complete. Processed </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">df_result</span><span class="p">)</span><span class="si">}</span><span class="s"> rows.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df_result</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="2-data-transformation-layer"><span class="me-2">2. Data Transformation Layer</span><a href="#2-data-transformation-layer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>After landing raw data, the transformation component converts it into a proper dimensional model:</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">process_sales_data</span><span class="p">(</span><span class="n">engine</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Process and transform sales data from raw to fact table.
    </span><span class="sh">"""</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get dimension lookups
</span>        <span class="n">channel_ids</span> <span class="o">=</span> <span class="nf">populate_dim_channel</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
        <span class="n">location_ids</span> <span class="o">=</span> <span class="nf">populate_dim_location</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
        <span class="n">product_ids</span> <span class="o">=</span> <span class="nf">populate_dim_product</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
        <span class="n">retailer_ids</span> <span class="o">=</span> <span class="nf">populate_dim_retailer</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
        <span class="n">date_ids</span> <span class="o">=</span> <span class="nf">populate_dim_date</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
        
        <span class="c1"># Query to get raw sales data
</span>        <span class="n">query</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
        SELECT </span><span class="sh">"</span><span class="s">SaleID</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">ProductID</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">RetailerID</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">Channel</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">Location</span><span class="sh">"</span><span class="s">, 
               </span><span class="sh">"</span><span class="s">Quantity</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">Price</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">Date</span><span class="sh">"</span><span class="s">
        FROM raw.sales
        WHERE </span><span class="sh">"</span><span class="s">SaleID</span><span class="sh">"</span><span class="s"> NOT IN (
            SELECT sale_id::VARCHAR FROM transformed.fact_sales
        )
        ORDER BY </span><span class="sh">"</span><span class="s">SaleID</span><span class="sh">"</span><span class="s"> ASC
        </span><span class="sh">"""</span>
        
        <span class="k">with</span> <span class="n">engine</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="c1"># Count total records to process
</span>            <span class="n">count_query</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
            SELECT COUNT(*) FROM raw.sales
            WHERE </span><span class="sh">"</span><span class="s">SaleID</span><span class="sh">"</span><span class="s"> NOT IN (
                SELECT sale_id::VARCHAR FROM transformed.fact_sales
            )
            </span><span class="sh">"""</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="nf">text</span><span class="p">(</span><span class="n">count_query</span><span class="p">))</span>
            <span class="n">total_records</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="nf">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Found </span><span class="si">{</span><span class="n">total_records</span><span class="si">}</span><span class="s"> new sales records to process</span><span class="sh">"</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">total_records</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">No new records to process</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">0</span>
            
            <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="nf">text</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
            <span class="n">sales</span> <span class="o">=</span> <span class="p">[</span><span class="nf">dict</span><span class="p">(</span><span class="nf">zip</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="nf">keys</span><span class="p">(),</span> <span class="n">row</span><span class="p">))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
            
            <span class="c1"># Transform data
</span>            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Processing </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">sales</span><span class="p">)</span><span class="si">}</span><span class="s"> sales records</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">processed_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">fact_records</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="c1"># Process each sale record
</span>            <span class="k">for</span> <span class="n">sale</span> <span class="ow">in</span> <span class="n">sales</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Data transformations here...
</span>                    
                    <span class="c1"># Create fact record
</span>                    <span class="n">fact_record</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="sh">"</span><span class="s">sale_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">sale_id</span><span class="p">,</span>
                        <span class="sh">"</span><span class="s">product_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">product_id</span><span class="p">,</span>
                        <span class="sh">"</span><span class="s">retailer_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">retailer_id</span><span class="p">,</span>
                        <span class="sh">"</span><span class="s">location_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">location_id</span><span class="p">,</span>
                        <span class="sh">"</span><span class="s">channel_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">channel_id</span><span class="p">,</span>
                        <span class="sh">"</span><span class="s">date_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">date_id</span><span class="p">,</span>
                        <span class="sh">"</span><span class="s">quantity</span><span class="sh">"</span><span class="p">:</span> <span class="n">quantity</span><span class="p">,</span>
                        <span class="sh">"</span><span class="s">unit_price</span><span class="sh">"</span><span class="p">:</span> <span class="n">unit_price</span><span class="p">,</span>
                        <span class="sh">"</span><span class="s">total_amount</span><span class="sh">"</span><span class="p">:</span> <span class="n">total_amount</span>
                    <span class="p">}</span>
                    <span class="n">fact_records</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">fact_record</span><span class="p">)</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error processing sale </span><span class="si">{</span><span class="n">sale</span><span class="p">[</span><span class="sh">'</span><span class="s">SaleID</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            
            <span class="c1"># Insert fact records
</span>            <span class="k">if</span> <span class="n">fact_records</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">insert_query</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
                    INSERT INTO transformed.fact_sales (
                        sale_id, product_id, retailer_id, location_id, 
                        channel_id, date_id, quantity, unit_price, total_amount
                    )
                    VALUES (
                        :sale_id, :product_id, :retailer_id, :location_id, 
                        :channel_id, :date_id, :quantity, :unit_price, :total_amount
                    )
                    ON CONFLICT (sale_id) DO NOTHING
                    </span><span class="sh">"""</span>
                    <span class="c1"># Use a new transaction to ensure atomicity
</span>                    <span class="k">with</span> <span class="n">engine</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">insert_conn</span><span class="p">:</span>
                        <span class="n">insert_conn</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="nf">text</span><span class="p">(</span><span class="n">insert_query</span><span class="p">),</span> <span class="n">fact_records</span><span class="p">)</span>
                    
                    <span class="n">processed_count</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">fact_records</span><span class="p">)</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Inserted </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">fact_records</span><span class="p">)</span><span class="si">}</span><span class="s"> records into fact_sales</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error inserting: </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Successfully processed </span><span class="si">{</span><span class="n">processed_count</span><span class="si">}</span><span class="s"> sales records</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">processed_count</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error processing sales data: </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">raise</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="3-dbt-transformation-models"><span class="me-2">3. dbt Transformation Models</span><a href="#3-dbt-transformation-models" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>For the analytical layer, I implemented dbt models that further refine the data:</p>

<p>First, a staging model to standardize raw data formats:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre></td><td class="rouge-code"><pre><span class="c1">-- stg_sales.sql</span>

<span class="k">with</span> <span class="k">source</span> <span class="k">as</span> <span class="p">(</span>
    <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="p">{{</span> <span class="k">source</span><span class="p">(</span><span class="s1">'postgres'</span><span class="p">,</span> <span class="s1">'sales'</span><span class="p">)</span> <span class="p">}}</span>
<span class="p">),</span>

<span class="n">cleaned</span> <span class="k">as</span> <span class="p">(</span>
    <span class="k">select</span>
        <span class="nv">"SaleID"</span><span class="p">::</span><span class="nb">integer</span> <span class="k">as</span> <span class="n">sale_id</span><span class="p">,</span>
        <span class="k">nullif</span><span class="p">(</span><span class="nv">"ProductID"</span><span class="p">,</span> <span class="s1">''</span><span class="p">)::</span><span class="nb">integer</span> <span class="k">as</span> <span class="n">product_id</span><span class="p">,</span>
        <span class="nv">"ProductName"</span> <span class="k">as</span> <span class="n">product_name</span><span class="p">,</span>
        <span class="nv">"Brand"</span> <span class="k">as</span> <span class="n">brand</span><span class="p">,</span>
        <span class="nv">"Category"</span> <span class="k">as</span> <span class="n">category</span><span class="p">,</span>
        <span class="nv">"RetailerID"</span><span class="p">::</span><span class="nb">integer</span> <span class="k">as</span> <span class="n">retailer_id</span><span class="p">,</span>
        <span class="nv">"RetailerName"</span> <span class="k">as</span> <span class="n">retailer_name</span><span class="p">,</span>
        <span class="nv">"Channel"</span> <span class="k">as</span> <span class="n">channel</span><span class="p">,</span>
        <span class="n">coalesce</span><span class="p">(</span><span class="k">nullif</span><span class="p">(</span><span class="nv">"Location"</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span> <span class="s1">'Unknown'</span><span class="p">)</span> <span class="k">as</span> <span class="k">location</span><span class="p">,</span>
        <span class="k">case</span> 
            <span class="k">when</span> <span class="nv">"Quantity"</span> <span class="o">~</span> <span class="s1">'^-?</span><span class="se">\d</span><span class="s1">+$'</span> <span class="k">then</span> <span class="nv">"Quantity"</span><span class="p">::</span><span class="nb">integer</span>
            <span class="k">else</span> <span class="k">null</span>
        <span class="k">end</span> <span class="k">as</span> <span class="n">quantity</span><span class="p">,</span>
        <span class="k">case</span>
            <span class="k">when</span> <span class="nv">"Price"</span> <span class="o">~</span> <span class="s1">'^</span><span class="se">\d</span><span class="s1">+$'</span> <span class="k">then</span> <span class="nv">"Price"</span><span class="p">::</span><span class="nb">decimal</span>
            <span class="k">when</span> <span class="nv">"Price"</span> <span class="o">~</span> <span class="s1">'^</span><span class="se">\d</span><span class="s1">+USD$'</span> <span class="k">then</span> <span class="k">replace</span><span class="p">(</span><span class="nv">"Price"</span><span class="p">,</span> <span class="s1">'USD'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)::</span><span class="nb">decimal</span>
            <span class="k">else</span> <span class="k">null</span>
        <span class="k">end</span> <span class="k">as</span> <span class="n">price</span><span class="p">,</span>
        <span class="k">case</span>
            <span class="k">when</span> <span class="nv">"Date"</span> <span class="o">~</span> <span class="s1">'^</span><span class="se">\d</span><span class="s1">{4}-</span><span class="se">\d</span><span class="s1">{2}-</span><span class="se">\d</span><span class="s1">{2}$'</span> <span class="k">then</span> <span class="nv">"Date"</span><span class="p">::</span><span class="nb">date</span>
            <span class="k">when</span> <span class="nv">"Date"</span> <span class="o">~</span> <span class="s1">'^</span><span class="se">\d</span><span class="s1">{4}/</span><span class="se">\d</span><span class="s1">{2}/</span><span class="se">\d</span><span class="s1">{2}$'</span> <span class="k">then</span> <span class="n">to_date</span><span class="p">(</span><span class="nv">"Date"</span><span class="p">,</span> <span class="s1">'YYYY/MM/DD'</span><span class="p">)</span>
            <span class="k">else</span> <span class="k">null</span>
        <span class="k">end</span> <span class="k">as</span> <span class="nb">date</span><span class="p">,</span>
        <span class="n">batch_id</span><span class="p">,</span>
        <span class="n">source_file</span><span class="p">,</span>
        <span class="n">inserted_at</span>
    <span class="k">from</span> <span class="k">source</span>
<span class="p">),</span>

<span class="k">final</span> <span class="k">as</span> <span class="p">(</span>
    <span class="k">select</span>
        <span class="n">sale_id</span><span class="p">,</span>
        <span class="n">product_id</span><span class="p">,</span>
        <span class="n">product_name</span><span class="p">,</span>
        <span class="n">brand</span><span class="p">,</span>
        <span class="n">category</span><span class="p">,</span>
        <span class="n">retailer_id</span><span class="p">,</span>
        <span class="n">retailer_name</span><span class="p">,</span>
        <span class="n">channel</span><span class="p">,</span>
        <span class="k">location</span><span class="p">,</span>
        <span class="k">case</span> <span class="k">when</span> <span class="n">quantity</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">null</span> <span class="k">else</span> <span class="n">quantity</span> <span class="k">end</span> <span class="k">as</span> <span class="n">quantity</span><span class="p">,</span>
        <span class="n">price</span><span class="p">,</span>
        <span class="nb">date</span><span class="p">,</span>
        <span class="n">batch_id</span><span class="p">,</span>
        <span class="n">source_file</span><span class="p">,</span>
        <span class="n">inserted_at</span><span class="p">,</span>
        <span class="k">current_timestamp</span> <span class="k">as</span> <span class="n">transformed_at</span>
    <span class="k">from</span> <span class="n">cleaned</span>
    <span class="k">where</span> 
        <span class="n">sale_id</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span>
        <span class="k">and</span> <span class="n">product_id</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span>
        <span class="k">and</span> <span class="n">retailer_id</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span>
        <span class="k">and</span> <span class="nb">date</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span>
        <span class="k">and</span> <span class="n">quantity</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span>
        <span class="k">and</span> <span class="n">price</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">)</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">final</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Then dimensional models built on top of staging:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre></td><td class="rouge-code"><pre><span class="c1">-- fact_sales.sql</span>

<span class="p">{{</span>
  <span class="n">config</span><span class="p">(</span>
    <span class="n">unique_key</span> <span class="o">=</span> <span class="s1">'sale_id'</span><span class="p">,</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span><span class="s1">'columns'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'sale_id'</span><span class="p">],</span> <span class="s1">'unique'</span><span class="p">:</span> <span class="k">True</span><span class="p">},</span>
      <span class="p">{</span><span class="s1">'columns'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'product_id'</span><span class="p">]},</span>
      <span class="p">{</span><span class="s1">'columns'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'retailer_id'</span><span class="p">]},</span>
      <span class="p">{</span><span class="s1">'columns'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'location_id'</span><span class="p">]},</span>
      <span class="p">{</span><span class="s1">'columns'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'channel_id'</span><span class="p">]},</span>
      <span class="p">{</span><span class="s1">'columns'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'date_id'</span><span class="p">]}</span>
    <span class="p">]</span>
  <span class="p">)</span>
<span class="p">}}</span>

<span class="k">with</span> <span class="n">stg_sales</span> <span class="k">as</span> <span class="p">(</span>
    <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="p">{{</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'stg_sales'</span><span class="p">)</span> <span class="p">}}</span>
<span class="p">),</span>

<span class="n">dim_product</span> <span class="k">as</span> <span class="p">(</span>
    <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="p">{{</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'dim_product'</span><span class="p">)</span> <span class="p">}}</span>
<span class="p">),</span>

<span class="n">dim_location</span> <span class="k">as</span> <span class="p">(</span>
    <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="p">{{</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'dim_location'</span><span class="p">)</span> <span class="p">}}</span>
<span class="p">),</span>

<span class="c1">-- Create dimension references for retailer and channel</span>
<span class="n">dim_retailer</span> <span class="k">as</span> <span class="p">(</span>
    <span class="k">select</span> <span class="k">distinct</span>
        <span class="n">retailer_id</span><span class="p">,</span>
        <span class="n">retailer_name</span>
    <span class="k">from</span> <span class="n">stg_sales</span>
<span class="p">),</span>

<span class="n">dim_channel</span> <span class="k">as</span> <span class="p">(</span>
    <span class="k">select</span>
        <span class="n">channel</span><span class="p">,</span>
        <span class="p">{{</span> <span class="n">dbt_utils</span><span class="p">.</span><span class="n">generate_surrogate_key</span><span class="p">([</span><span class="s1">'channel'</span><span class="p">])</span> <span class="p">}}</span> <span class="k">as</span> <span class="n">channel_id</span>
    <span class="k">from</span> <span class="n">stg_sales</span>
    <span class="k">group</span> <span class="k">by</span> <span class="n">channel</span>
<span class="p">),</span>

<span class="c1">-- Final fact sales table</span>
<span class="k">final</span> <span class="k">as</span> <span class="p">(</span>
    <span class="k">select</span>
        <span class="n">s</span><span class="p">.</span><span class="n">sale_id</span><span class="p">,</span>
        <span class="n">s</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span>
        <span class="n">s</span><span class="p">.</span><span class="n">retailer_id</span><span class="p">,</span>
        <span class="n">l</span><span class="p">.</span><span class="n">location_id</span><span class="p">,</span>
        <span class="k">c</span><span class="p">.</span><span class="n">channel_id</span><span class="p">,</span>
        <span class="n">s</span><span class="p">.</span><span class="nb">date</span> <span class="k">as</span> <span class="n">date_id</span><span class="p">,</span>
        <span class="n">s</span><span class="p">.</span><span class="n">quantity</span><span class="p">,</span>
        <span class="n">s</span><span class="p">.</span><span class="n">price</span> <span class="o">/</span> <span class="k">nullif</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">quantity</span><span class="p">,</span> <span class="mi">0</span><span class="p">)::</span><span class="nb">numeric</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">unit_price</span><span class="p">,</span>
        <span class="n">s</span><span class="p">.</span><span class="n">price</span><span class="p">::</span><span class="nb">numeric</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_amount</span><span class="p">,</span>
        <span class="n">s</span><span class="p">.</span><span class="n">transformed_at</span>
    <span class="k">from</span> <span class="n">stg_sales</span> <span class="n">s</span>
    <span class="k">inner</span> <span class="k">join</span> <span class="n">dim_location</span> <span class="n">l</span> <span class="k">on</span> <span class="n">l</span><span class="p">.</span><span class="k">location</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="k">location</span>
    <span class="k">inner</span> <span class="k">join</span> <span class="n">dim_channel</span> <span class="k">c</span> <span class="k">on</span> <span class="k">c</span><span class="p">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">channel</span>
    <span class="p">{</span><span class="o">%</span> <span class="n">if</span> <span class="n">is_incremental</span><span class="p">()</span> <span class="o">%</span><span class="p">}</span>
    <span class="k">where</span> <span class="n">s</span><span class="p">.</span><span class="n">transformed_at</span> <span class="o">&gt;</span> <span class="p">(</span><span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">transformed_at</span><span class="p">)</span> <span class="k">from</span> <span class="p">{{</span> <span class="n">this</span> <span class="p">}})</span>
    <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
<span class="p">)</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">final</span>

</pre></td></tr></tbody></table></code></div></div>

<h3 id="4-orchestration-with-airflow"><span class="me-2">4. Orchestration with Airflow</span><a href="#4-orchestration-with-airflow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The Airflow DAGs orchestrate the entire pipeline. I implemented two primary DAGs:</p>

<ol>
  <li>The Sales Data Pipeline for ingestion and initial transformation:</li>
</ol>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1"># Define task dependencies
</span><span class="n">check_file_exists</span> <span class="o">&gt;&gt;</span> <span class="n">check_and_ingest_data</span> <span class="o">&gt;&gt;</span> <span class="n">transform_raw_data</span> <span class="o">&gt;&gt;</span> <span class="n">archive_file</span>
</pre></td></tr></tbody></table></code></div></div>

<ol>
  <li>The dbt Transformation Pipeline for analytical models:</li>
</ol>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="c1"># Define dbt commands
</span><span class="n">dbt_deps_cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"""</span><span class="s">
cd </span><span class="si">{</span><span class="n">DBT_PROJECT_DIR</span><span class="si">}</span><span class="s"> &amp;&amp; 
dbt deps --profiles-dir </span><span class="si">{</span><span class="n">DBT_PROFILES_DIR</span><span class="si">}</span><span class="s"> --target </span><span class="si">{</span><span class="n">DBT_TARGET</span><span class="si">}</span><span class="s">
</span><span class="sh">"""</span>

<span class="n">dbt_run_staging_cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"""</span><span class="s">
cd </span><span class="si">{</span><span class="n">DBT_PROJECT_DIR</span><span class="si">}</span><span class="s"> &amp;&amp; 
dbt run --models </span><span class="sh">"</span><span class="s">staging.*</span><span class="sh">"</span><span class="s"> --profiles-dir </span><span class="si">{</span><span class="n">DBT_PROFILES_DIR</span><span class="si">}</span><span class="s"> --target </span><span class="si">{</span><span class="n">DBT_TARGET</span><span class="si">}</span><span class="s">
</span><span class="sh">"""</span>

<span class="n">dbt_run_marts_cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"""</span><span class="s">
cd </span><span class="si">{</span><span class="n">DBT_PROJECT_DIR</span><span class="si">}</span><span class="s"> &amp;&amp; 
dbt run --models </span><span class="sh">"</span><span class="s">marts.*</span><span class="sh">"</span><span class="s"> --profiles-dir </span><span class="si">{</span><span class="n">DBT_PROFILES_DIR</span><span class="si">}</span><span class="s"> --target </span><span class="si">{</span><span class="n">DBT_TARGET</span><span class="si">}</span><span class="s">
</span><span class="sh">"""</span>

<span class="n">dbt_test_cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"""</span><span class="s">
cd </span><span class="si">{</span><span class="n">DBT_PROJECT_DIR</span><span class="si">}</span><span class="s"> &amp;&amp; 
dbt test --profiles-dir </span><span class="si">{</span><span class="n">DBT_PROFILES_DIR</span><span class="si">}</span><span class="s"> --target </span><span class="si">{</span><span class="n">DBT_TARGET</span><span class="si">}</span><span class="s">
</span><span class="sh">"""</span>

<span class="c1"># Define task dependencies
</span><span class="n">check_and_ingest_data</span> <span class="o">&gt;&gt;</span> <span class="n">install_dependencies</span> <span class="o">&gt;&gt;</span> <span class="n">run_staging_models</span> <span class="o">&gt;&gt;</span> <span class="n">run_mart_models</span> <span class="o">&gt;&gt;</span> <span class="n">test_models</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="advanced-features"><span class="me-2">Advanced Features</span><a href="#advanced-features" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="self-healing-data-flow"><span class="me-2">Self-healing Data Flow</span><a href="#self-healing-data-flow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>A key feature of this pipeline is its “self-healing” capability. Both DAGs automatically check if the required data exists before proceeding, and trigger upstream processes if needed:</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">RawDataSensor</span><span class="p">(</span><span class="n">BaseSensorOperator</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Sensor to check if there</span><span class="sh">'</span><span class="s">s data in the raw.sales table.
    </span><span class="sh">"""</span>
    <span class="nd">@apply_defaults</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">conn_id</span><span class="o">=</span><span class="sh">"</span><span class="s">sales_db</span><span class="sh">"</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">conn_id</span> <span class="o">=</span> <span class="n">conn_id</span>

    <span class="k">def</span> <span class="nf">poke</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">hook</span> <span class="o">=</span> <span class="nc">PostgresHook</span><span class="p">(</span><span class="n">postgres_conn_id</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">conn_id</span><span class="p">)</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="sh">"</span><span class="s">SELECT COUNT(*) FROM raw.sales</span><span class="sh">"</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">hook</span><span class="p">.</span><span class="nf">get_first</span><span class="p">(</span><span class="n">sql</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">self</span><span class="p">.</span><span class="n">log</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Found </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s"> rows in raw.sales table</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">check_and_ingest_data</span><span class="p">(</span><span class="n">csv_file_path</span><span class="p">,</span> <span class="n">conn_id</span><span class="o">=</span><span class="sh">"</span><span class="s">sales_db</span><span class="sh">"</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Check if data exists in raw.sales and ingest if empty.
    </span><span class="sh">"""</span>
    <span class="n">hook</span> <span class="o">=</span> <span class="nc">PostgresHook</span><span class="p">(</span><span class="n">postgres_conn_id</span><span class="o">=</span><span class="n">conn_id</span><span class="p">)</span>
    
    <span class="c1"># Check if data exists
</span>    <span class="n">sql</span> <span class="o">=</span> <span class="sh">"</span><span class="s">SELECT COUNT(*) FROM raw.sales</span><span class="sh">"</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">hook</span><span class="p">.</span><span class="nf">get_first</span><span class="p">(</span><span class="n">sql</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># If data exists, return True
</span>    <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">ti</span><span class="sh">'</span><span class="p">].</span><span class="nf">xcom_push</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sh">'</span><span class="s">data_already_exists</span><span class="sh">'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
    
    <span class="c1"># If no data, perform ingestion
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">ingest_main</span> <span class="o">=</span> <span class="nf">import_ingest_module</span><span class="p">()</span>
        <span class="n">records_loaded</span> <span class="o">=</span> <span class="nf">ingest_main</span><span class="p">(</span><span class="n">csv_file_path</span><span class="p">)</span>
        
        <span class="c1"># Verify ingestion was successful
</span>        <span class="k">if</span> <span class="n">records_loaded</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">ti</span><span class="sh">'</span><span class="p">].</span><span class="nf">xcom_push</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sh">'</span><span class="s">records_loaded</span><span class="sh">'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">records_loaded</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">ti</span><span class="sh">'</span><span class="p">].</span><span class="nf">xcom_push</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sh">'</span><span class="s">ingest_failed</span><span class="sh">'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">ti</span><span class="sh">'</span><span class="p">].</span><span class="nf">xcom_push</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sh">'</span><span class="s">ingest_error</span><span class="sh">'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This design enables either pipeline to be triggered independently without failures, creating a more resilient system.</p>

<h3 id="data-quality-testing"><span class="me-2">Data Quality Testing</span><a href="#data-quality-testing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Comprehensive data quality checks are implemented in both Python and dbt:</p>

<ol>
  <li>Python validation for source data:</li>
</ol>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">validate_data</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Validate data quality and identify invalid records.
    Returns a boolean indicating if the data is valid and a list of invalid indices.
    </span><span class="sh">"""</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Validating data... Total records: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Track invalid rows for logging
</span>    <span class="n">invalid_rows</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">dates</span><span class="sh">'</span><span class="p">:</span> <span class="p">[],</span>
        <span class="sh">'</span><span class="s">quantities</span><span class="sh">'</span><span class="p">:</span> <span class="p">[],</span>
        <span class="sh">'</span><span class="s">prices</span><span class="sh">'</span><span class="p">:</span> <span class="p">[],</span>
        <span class="sh">'</span><span class="s">all</span><span class="sh">'</span><span class="p">:</span> <span class="nf">set</span><span class="p">()</span>  <span class="c1"># Use a set to avoid duplicates
</span>    <span class="p">}</span>
    
    <span class="c1"># Check for invalid dates
</span>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">date_str</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Date</span><span class="sh">'</span><span class="p">]):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Try to parse the date
</span>            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">date_str</span><span class="p">:</span>
                <span class="c1"># Handle different date formats
</span>                <span class="k">if</span> <span class="sh">'</span><span class="s">/</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">date_str</span><span class="p">:</span>
                    <span class="n">datetime</span><span class="p">.</span><span class="nf">strptime</span><span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="sh">'</span><span class="s">%Y/%m/%d</span><span class="sh">'</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">datetime</span><span class="p">.</span><span class="nf">strptime</span><span class="p">(</span><span class="n">date_str</span><span class="p">,</span> <span class="sh">'</span><span class="s">%Y-%m-%d</span><span class="sh">'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Empty or non-string date
</span>                <span class="n">invalid_rows</span><span class="p">[</span><span class="sh">'</span><span class="s">dates</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">((</span><span class="n">idx</span><span class="p">,</span> <span class="n">date_str</span><span class="p">))</span>
                <span class="n">invalid_rows</span><span class="p">[</span><span class="sh">'</span><span class="s">all</span><span class="sh">'</span><span class="p">].</span><span class="nf">add</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
            <span class="n">invalid_rows</span><span class="p">[</span><span class="sh">'</span><span class="s">dates</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">((</span><span class="n">idx</span><span class="p">,</span> <span class="n">date_str</span><span class="p">))</span>
            <span class="n">invalid_rows</span><span class="p">[</span><span class="sh">'</span><span class="s">all</span><span class="sh">'</span><span class="p">].</span><span class="nf">add</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
    
    <span class="c1"># More validation checks...
</span>    
    <span class="k">return</span> <span class="n">is_valid</span><span class="p">,</span> <span class="nf">list</span><span class="p">(</span><span class="n">invalid_rows</span><span class="p">[</span><span class="sh">'</span><span class="s">all</span><span class="sh">'</span><span class="p">])</span>
</pre></td></tr></tbody></table></code></div></div>

<ol>
  <li>dbt tests for transformed data:</li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="c1"># schema.yml for fact_sales</span>
<span class="na">version</span><span class="pi">:</span> <span class="m">2</span>

<span class="na">models</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">fact_sales</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Fact</span><span class="nv"> </span><span class="s">table</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">sales</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">related</span><span class="nv"> </span><span class="s">dimension</span><span class="nv"> </span><span class="s">keys"</span>
    <span class="na">columns</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">sale_id</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">The</span><span class="nv"> </span><span class="s">primary</span><span class="nv"> </span><span class="s">key</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">sales</span><span class="nv"> </span><span class="s">transaction"</span>
        <span class="na">tests</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">unique</span>
          <span class="pi">-</span> <span class="s">not_null</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">product_id</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Foreign</span><span class="nv"> </span><span class="s">key</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">product</span><span class="nv"> </span><span class="s">dimension"</span>
        <span class="na">tests</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">not_null</span>
          <span class="pi">-</span> <span class="na">relationships</span><span class="pi">:</span>
              <span class="na">to</span><span class="pi">:</span> <span class="s">ref('dim_product')</span>
              <span class="na">field</span><span class="pi">:</span> <span class="s">product_id</span>
      
      <span class="c1"># Additional column tests...</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">quantity</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Number</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">items</span><span class="nv"> </span><span class="s">sold"</span>
        <span class="na">tests</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">not_null</span>
          <span class="pi">-</span> <span class="s">positive_values</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="incremental-processing"><span class="me-2">Incremental Processing</span><a href="#incremental-processing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The pipeline implements incremental processing at multiple levels:</p>

<ol>
  <li>Python-based ETL uses ID-based tracking:</li>
</ol>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c1"># Query to get only new records 
</span><span class="n">query</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
SELECT </span><span class="sh">"</span><span class="s">SaleID</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">ProductID</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">RetailerID</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">Channel</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">Location</span><span class="sh">"</span><span class="s">, 
       </span><span class="sh">"</span><span class="s">Quantity</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">Price</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">Date</span><span class="sh">"</span><span class="s">
FROM raw.sales
WHERE </span><span class="sh">"</span><span class="s">SaleID</span><span class="sh">"</span><span class="s"> NOT IN (
    SELECT sale_id::VARCHAR FROM transformed.fact_sales
)
ORDER BY </span><span class="sh">"</span><span class="s">SaleID</span><span class="sh">"</span><span class="s"> ASC
</span><span class="sh">"""</span>
</pre></td></tr></tbody></table></code></div></div>

<ol>
  <li>dbt models use incremental materialization:</li>
</ol>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>
<span class="p">{</span><span class="o">%</span> <span class="n">if</span> <span class="n">is_incremental</span><span class="p">()</span> <span class="o">%</span><span class="p">}</span>
<span class="k">where</span> <span class="n">s</span><span class="p">.</span><span class="n">transformed_at</span> <span class="o">&gt;</span> <span class="p">(</span><span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">transformed_at</span><span class="p">)</span> <span class="k">from</span> <span class="p">{{</span> <span class="n">this</span> <span class="p">}})</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>

</pre></td></tr></tbody></table></code></div></div>

<p>This two-tiered approach ensures efficient processing of only new or changed data.</p>

<h2 id="containerization-and-deployment"><span class="me-2">Containerization and Deployment</span><a href="#containerization-and-deployment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>The entire solution is containerized using Docker for consistent deployment:</p>

<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="na">services</span><span class="pi">:</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:latest</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">POSTGRES_USER=postgres</span>
      <span class="pi">-</span> <span class="s">POSTGRES_PASSWORD=mysecretpassword</span>
      <span class="pi">-</span> <span class="s">POSTGRES_MULTIPLE_DATABASES=airflow,sales</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./initdb:/docker-entrypoint-initdb.d</span>
      <span class="pi">-</span> <span class="s">postgres-db-volume:/var/lib/postgresql/data</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">pg_isready"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-U"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">postgres"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">5s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">5</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5433:5432"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>

  <span class="na">airflow-webserver</span><span class="pi">:</span>
    <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*airflow-common</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">webserver</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">8081:8080</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">--fail"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:8081/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">5</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>

  <span class="c1"># Additional services...</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="scalability-approaches"><span class="me-2">Scalability Approaches</span><a href="#scalability-approaches" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>As the data volume grows, several scalability enhancements can be implemented:</p>

<h3 id="1-partitioning-for-larger-datasets"><span class="me-2">1. Partitioning for Larger Datasets</span><a href="#1-partitioning-for-larger-datasets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>For larger datasets, implementing table partitioning in PostgreSQL can significantly improve performance:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="c1">-- Example of adding partitioning to fact_sales</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">analytics</span><span class="p">.</span><span class="n">fact_sales</span> <span class="p">(</span>
    <span class="n">sale_id</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="c1">-- other columns...</span>
    <span class="n">date_id</span> <span class="nb">DATE</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span> <span class="k">PARTITION</span> <span class="k">BY</span> <span class="k">RANGE</span> <span class="p">(</span><span class="n">date_id</span><span class="p">);</span>

<span class="c1">-- Create partitions by month</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">fact_sales_2024_q1</span> <span class="k">PARTITION</span> <span class="k">OF</span> <span class="n">fact_sales</span>
    <span class="k">FOR</span> <span class="k">VALUES</span> <span class="k">FROM</span> <span class="p">(</span><span class="s1">'2024-01-01'</span><span class="p">)</span> <span class="k">TO</span> <span class="p">(</span><span class="s1">'2024-04-01'</span><span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">fact_sales_2024_q2</span> <span class="k">PARTITION</span> <span class="k">OF</span> <span class="n">fact_sales</span>
    <span class="k">FOR</span> <span class="k">VALUES</span> <span class="k">FROM</span> <span class="p">(</span><span class="s1">'2024-04-01'</span><span class="p">)</span> <span class="k">TO</span> <span class="p">(</span><span class="s1">'2024-07-01'</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="2-parallel-processing-with-airflow"><span class="me-2">2. Parallel Processing with Airflow</span><a href="#2-parallel-processing-with-airflow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>For processing large volumes of data, implementing parallel task execution in Airflow:</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1"># Create parallel tasks for processing different data segments
</span><span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="nf">get_data_segments</span><span class="p">():</span>
    <span class="n">process_segment</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sa">f</span><span class="sh">'</span><span class="s">process_segment_</span><span class="si">{</span><span class="n">segment</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">process_data_segment</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">segment</span><span class="sh">'</span><span class="p">:</span> <span class="n">segment</span><span class="p">},</span>
        <span class="n">dag</span><span class="o">=</span><span class="n">dag</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># Set dependencies
</span>    <span class="n">check_and_ingest_data</span> <span class="o">&gt;&gt;</span> <span class="n">process_segment</span> <span class="o">&gt;&gt;</span> <span class="n">merge_segments</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="3-enhanced-incremental-processing"><span class="me-2">3. Enhanced Incremental Processing</span><a href="#3-enhanced-incremental-processing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The current incremental approach can be enhanced with timestamp-based windowing:</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">extract_incremental_data</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Extract data in time-bounded batches for efficient processing.</span><span class="sh">"""</span>
    <span class="n">current_position</span> <span class="o">=</span> <span class="n">start_time</span>
    
    <span class="k">while</span> <span class="n">current_position</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">:</span>
        <span class="n">next_position</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">current_position</span> <span class="o">+</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">end_time</span><span class="p">)</span>
        
        <span class="n">query</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
        SELECT * FROM raw.sales
        WHERE inserted_at &gt;= %s AND inserted_at &lt; %s
        ORDER BY inserted_at
        LIMIT %s
        </span><span class="sh">"""</span>
        
        <span class="k">yield</span> <span class="nf">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">current_position</span><span class="p">,</span> <span class="n">next_position</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">))</span>
        <span class="n">current_position</span> <span class="o">=</span> <span class="n">next_position</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This approach reduces memory pressure when dealing with large datasets.</p>

<h2 id="optimization-techniques"><span class="me-2">Optimization Techniques</span><a href="#optimization-techniques" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="1-database-indexing-strategy"><span class="me-2">1. Database Indexing Strategy</span><a href="#1-database-indexing-strategy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Carefully designed indexes dramatically improve query performance:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c1">-- Indexes for the fact table</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_fact_sales_product_id</span> <span class="k">ON</span> <span class="n">transformed</span><span class="p">.</span><span class="n">fact_sales</span><span class="p">(</span><span class="n">product_id</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_fact_sales_retailer_id</span> <span class="k">ON</span> <span class="n">transformed</span><span class="p">.</span><span class="n">fact_sales</span><span class="p">(</span><span class="n">retailer_id</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_fact_sales_date_id</span> <span class="k">ON</span> <span class="n">transformed</span><span class="p">.</span><span class="n">fact_sales</span><span class="p">(</span><span class="n">date_id</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_fact_sales_channel_id</span> <span class="k">ON</span> <span class="n">transformed</span><span class="p">.</span><span class="n">fact_sales</span><span class="p">(</span><span class="n">channel_id</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="2-memory-efficient-processing"><span class="me-2">2. Memory-Efficient Processing</span><a href="#2-memory-efficient-processing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>For large datasets, implement batch processing to control memory usage:</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">process_large_dataset</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Process large CSV files in batches to control memory usage.</span><span class="sh">"""</span>
    <span class="c1"># Use pandas chunking for memory efficiency
</span>    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">batch_size</span><span class="p">):</span>
        <span class="c1"># Validate and clean the chunk
</span>        <span class="n">is_valid</span><span class="p">,</span> <span class="n">invalid_indices</span> <span class="o">=</span> <span class="nf">validate_data</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid</span><span class="p">:</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">CleanData</span><span class="p">.</span><span class="nf">apply_all_cleaners</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="nf">filter_invalid_records</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">invalid_indices</span><span class="p">)</span>
            
        <span class="c1"># Process the cleaned chunk
</span>        <span class="nf">load_to_raw</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="nf">get_db_connection_string</span><span class="p">(),</span> <span class="n">file_path</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="3-airflow-task-configuration"><span class="me-2">3. Airflow Task Configuration</span><a href="#3-airflow-task-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Optimizing Airflow task configuration for better resource utilization:</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c1"># Task configuration for better resource management
</span><span class="n">task</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
    <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">transform_raw_data</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">python_callable</span><span class="o">=</span><span class="n">transform_main</span><span class="p">,</span>
    <span class="n">executor_config</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">'</span><span class="s">cpu_millicores</span><span class="sh">'</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">memory_mb</span><span class="sh">'</span><span class="p">:</span> <span class="mi">2048</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">dag</span><span class="o">=</span><span class="n">dag</span><span class="p">,</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>This data pipeline demonstrates how modern tools and architectural patterns can create a robust, production-ready data infrastructure. By combining Airflow’s orchestration capabilities with dbt’s transformation power and a well-designed schema, we’ve built a system that can handle real-world data challenges while maintaining flexibility for future growth.</p>

<p>Key takeaways from this implementation:</p>

<ol>
  <li>The value of a layered architectural approach (medallion pattern)</li>
  <li>The importance of separating validation from cleaning for better data quality management</li>
  <li>The benefits of self-healing data flows that can recover from failures</li>
  <li>How containerization provides environment consistency across development and production</li>
</ol>

<p>While no data pipeline is ever truly “complete” (data requirements evolve continuously), this implementation provides a solid foundation that can adapt to changing business needs. The patterns and practices demonstrated here can help create more resilient, maintainable data systems for organizations of any size.</p>

<p>The complete code for this project is available on GitHub at <a href="https://github.com/samuelTyh/airflow-dbt-sales-analytics">samuelTyh/airflow-dbt-sales-analytics</a>.</p>

<h2 id="future-work"><span class="me-2">Future Work</span><a href="#future-work" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Looking ahead, this pipeline could be enhanced with:</p>

<ol>
  <li><strong>Real-time streaming capabilities</strong>: Integrating a streaming solution like Kafka for near real-time data processing</li>
  <li><strong>Advanced data quality monitoring</strong>: Adding automated data quality monitoring with Great Expectations or dbt expectations</li>
  <li><strong>ML feature engineering</strong>: Extending the pipeline to generate features for machine learning models</li>
  <li><strong>Cloud-native deployment</strong>: Adapting the architecture for cloud platforms with services like AWS Glue, Azure Data Factory, or Google Cloud Dataflow</li>
</ol>

<p>These enhancements would further extend the capabilities of the pipeline while maintaining the core architectural principles that make it reliable and maintainable.</p>

<p>What data pipeline patterns have you found most effective in your work? Share your thoughts and questions in the comments below!</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/data-engineering/">Data Engineering</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/python/"
            class="post-tag no-text-decoration"
          >python</a>
        
          <a
            href="/tags/postgres/"
            class="post-tag no-text-decoration"
          >postgres</a>
        
          <a
            href="/tags/airflow/"
            class="post-tag no-text-decoration"
          >airflow</a>
        
          <a
            href="/tags/dbt/"
            class="post-tag no-text-decoration"
          >dbt</a>
        
          <a
            href="/tags/etl/"
            class="post-tag no-text-decoration"
          >etl</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Building%20a%20Production-Ready%20Data%20Pipeline%20with%20Airflow%20and%20dbt%20-%20samueltyh&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fbuilding-a-production-ready-data-pipeline-with-airflow-and-dbt%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Building%20a%20Production-Ready%20Data%20Pipeline%20with%20Airflow%20and%20dbt%20-%20samueltyh&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fbuilding-a-production-ready-data-pipeline-with-airflow-and-dbt%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fbuilding-a-production-ready-data-pipeline-with-airflow-and-dbt%2F&text=Building%20a%20Production-Ready%20Data%20Pipeline%20with%20Airflow%20and%20dbt%20-%20samueltyh" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/year-end-reflection-landing-a-new-job-in-2025/">Year end reflection: landing a new job in 2025</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/useful-gadget-sharing-cron-job-org/">Useful gadget sharing - cron-job.org</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/setting-both-celery-and-flask-inside-the-docker-compose/">Setting both Celery and Flask inside the docker-compose</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/free-n8n-hosting-leveraging-hugging-face-spaces-and-supabase-for-persistent-workflow-automation/">Free n8n Hosting: Leveraging Hugging Face Spaces and Supabase for Persistent Workflow Automation</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/terraform-for-data-engineers-automating-your-data-infrastructure/">Terraform for Data Engineers: Automating Your Data Infrastructure</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/etl/">etl</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/devops/">devops</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/docker/">docker</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/postgres/">postgres</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/airflow/">airflow</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/application/">application</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/azure-data-studio/">azure-data-studio</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    










  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/building-a-scalable-etl-pipeline-for-adtech-analytics/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1745250420"
  data-df="ll"
  
>
  Apr 21, 2025
</time>

              <h4 class="pt-0 my-2">Building a Scalable ETL Pipeline for AdTech Analytics</h4>
              <div class="text-muted">
                <p>In the world of digital advertising, data is everything. Transforming raw operational data into actionable insights requires robust analytics pipelines. Recently, I implemented a comprehensive ETL ...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/implementing-fivetran-data-source-connector-with-aws-lambda/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1653770820"
  data-df="ll"
  
>
  May 28, 2022
</time>

              <h4 class="pt-0 my-2">Implementing Fivetran Data Source Connector with AWS Lambda</h4>
              <div class="text-muted">
                <p>Basic background of AWS Lambda  Official developer guide from AWS  AWS Lambda is a serverless, event-driven compute service that lets you run code for virtually any type of application or backend s...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/run-your-own-apache-spark-jobs-in-aws-emr-and-s3/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1612137600"
  data-df="ll"
  
>
  Feb  1, 2021
</time>

              <h4 class="pt-0 my-2">Run your own Apache Spark jobs in AWS EMR and S3</h4>
              <div class="text-muted">
                <p>Run your own Apache Spark jobs in AWS EMR and S3  Recently, I participated in Udacity’s Nanodegree Program for Data Engineers. It’s kinda like to review what I did past and refresh some tech stacks...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/building-a-scalable-etl-pipeline-for-adtech-analytics/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>Building a Scalable ETL Pipeline for AdTech Analytics</p>
    </a>
  

  
    <a
      href="/posts/terraform-for-data-engineers-automating-your-data-infrastructure/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>Terraform for Data Engineers: Automating Your Data Infrastructure</p>
    </a>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2025</time>

    
      <a href="https://twitter.com/samueltyh">Samuel Tseng</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.4.1"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/etl/">etl</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/devops/">devops</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/docker/">docker</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/postgres/">postgres</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/airflow/">airflow</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/application/">application</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/automation/">automation</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/azure-data-studio/">azure-data-studio</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->

  
  <script>
  var disqus_config = function () {
    this.page.url = 'http://localhost:4000/posts/building-a-production-ready-data-pipeline-with-airflow-and-dbt/';
    this.page.identifier = '/posts/building-a-production-ready-data-pipeline-with-airflow-and-dbt/';
  };

  function addDisqus() {
    let disqusThread = document.createElement('div');
    let paragraph = document.createElement('p');

    disqusThread.id = 'disqus_thread';
    paragraph.className = 'text-center text-muted small';
    paragraph.innerHTML = 'Comments powered by <a href="https://disqus.com/">Disqus</a>.';
    disqusThread.appendChild(paragraph);

    const footer = document.querySelector('footer');
    footer.insertAdjacentElement("beforebegin", disqusThread);
  }function reloadDisqus(event) {
    if (event.source === window && event.data && event.data.id === Theme.ID) {if (typeof DISQUS === 'undefined') {
        return;
      }

      if (document.readyState == 'complete') {
        DISQUS.reset({ reload: true, config: disqus_config });
      }
    }
  }

  addDisqus();

  if (Theme.switchable) {
    addEventListener('message', reloadDisqus);
  }var disqusObserver = new IntersectionObserver(
    function (entries) {
      if (entries[0].isIntersecting) {
        var d = document,
          s = d.createElement('script');
        s.src = 'https://samuelTyh.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);

        disqusObserver.disconnect();
      }
    },
    { threshold: [0] }
  );

  disqusObserver.observe(document.getElementById('disqus_thread'));
</script>



    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{content}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

